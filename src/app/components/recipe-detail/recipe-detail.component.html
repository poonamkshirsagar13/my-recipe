<div class="recipe-detail-container">
  <!-- Header -->
  <div class="recipe-header">
    <button (click)="goBack()" class="btn btn-secondary btn-sm">‚Üê Back</button>
    <h1>{{ isEditMode || recipe.Id === 0 ? 'Create New Recipe' : recipe.Title }}</h1>
    <button
      *ngIf="recipe.Id && recipe.Id > 0 && !isEditMode"
      (click)="toggleEditMode()"
      class="btn btn-primary btn-sm"
    >
      Edit
    </button>
  </div>

  <!-- Success Message -->
  <div *ngIf="successMessage" class="alert alert-success alert-dismissible fade show" role="alert">
    {{ successMessage }}
  </div>

  <!-- Error Message -->
  <div *ngIf="error" class="alert alert-danger alert-dismissible fade show" role="alert">
    {{ error }}
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="text-center">
    <p>Loading recipe details...</p>
  </div>

  <!-- Recipe Content -->
  <div *ngIf="!loading" class="recipe-content">
    <!-- Recipe Basic Information -->
    <div class="recipe-section card mb-4">
      <div class="card-header">
        <h3>Recipe Information</h3>
      </div>
      <div class="card-body">
        <div class="row">
          <!-- Image Section -->
          <div class="col-md-4">
            <div class="image-section">
              <div class="image-preview" *ngIf="imagePreview">
                <img [src]="getSafeImageUrl(imagePreview)" alt="Recipe" />
              </div>
              <div class="no-image" *ngIf="!imagePreview">
                <p>No image</p>
              </div>
              <input
                *ngIf="isEditMode"
                type="file"
                accept="image/*"
                (change)="onImageSelected($event)"
                class="form-control mt-2"
              />
            </div>
          </div>

          <!-- Recipe Details -->
          <div class="col-md-8">
            <div class="form-group mb-3">
              <label for="title" class="form-label">Recipe Title *</label>
              <input
                type="text"
                id="title"
                [(ngModel)]="recipe.Title"
                [disabled]="!isEditMode"
                class="form-control"
                placeholder="Enter recipe title"
              />
            </div>

            <div class="form-group mb-3">
              <label for="serving" class="form-label">Serving Size *</label>
              <input
                type="text"
                id="serving"
                [(ngModel)]="recipe.ServingSize"
                [disabled]="!isEditMode"
                class="form-control"
                placeholder="e.g., 4 servings"
              />
            </div>

            <div *ngIf="isEditMode" class="d-flex gap-2">
              <button (click)="saveRecipe()" [disabled]="isSaving" class="btn btn-success">
                <span *ngIf="!isSaving">Save Recipe</span>
                <span *ngIf="isSaving">Saving...</span>
              </button>
              <button (click)="toggleEditMode()" class="btn btn-secondary"> Cancel </button>
              <button
                *ngIf="recipe.Id && recipe.Id > 0"
                (click)="deleteRecipe()"
                class="btn btn-danger"
              >
                Delete Recipe
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Ingredients Section -->
    <div class="recipe-section card mb-4">
      <div class="card-header">
        <h3>Ingredients</h3>
      </div>
      <div class="card-body">
        <!-- Add New Ingredient Form -->
        <div class="add-ingredient-form mb-4" *ngIf="recipe.Id && recipe.Id > 0">
          <div class="row g-2">
            <div class="col-md-4">
              <input
                type="text"
                [(ngModel)]="newIngredient.Ingredient"
                class="form-control"
                placeholder="Ingredient name"
              />
            </div>
            <div class="col-md-2">
              <input
                type="number"
                [(ngModel)]="newIngredient.Qty"
                class="form-control"
                placeholder="Quantity"
              />
            </div>
            <div class="col-md-3">
              <input
                type="text"
                [(ngModel)]="newIngredient.Unit"
                class="form-control"
                placeholder="Unit (e.g., cup, tbsp)"
              />
            </div>
            <div class="col-md-3">
              <button (click)="addIngredient()" class="btn btn-primary w-100"> Add Ingredient </button>
            </div>
          </div>
        </div>

        <!-- Ingredients List -->
        <div *ngIf="ingredients.length === 0" class="alert alert-info">
          No ingredients added yet.
        </div>

        <div *ngIf="ingredients.length > 0" class="ingredients-list">
          <div *ngFor="let ingredient of ingredients; let i = index" class="ingredient-item card mb-2">
            <div class="card-body">
              <div class="row align-items-center">
                <div class="col-md-4">
                  <input
                    type="text"
                    [(ngModel)]="ingredient.Ingredient"
                    [disabled]="true"
                    class="form-control"
                  />
                </div>
                <div class="col-md-2">
                  <input
                    type="number"
                    [(ngModel)]="ingredient.Qty"
                    [disabled]="true"
                    class="form-control"
                  />
                </div>
                <div class="col-md-3">
                  <input
                    type="text"
                    [(ngModel)]="ingredient.Unit"
                    [disabled]="true"
                    class="form-control"
                  />
                </div>
                <div class="col-md-3 d-flex gap-2">
                  <button
                    *ngIf="isEditMode"
                    (click)="deleteIngredient(i)"
                    class="btn btn-danger btn-sm"
                  >
                    Delete
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Steps Section -->
    <div class="recipe-section card mb-4">
      <div class="card-header">
        <h3>Steps</h3>
      </div>
      <div class="card-body">
        <!-- Add New Step Form -->
        <div class="add-step-form mb-4" *ngIf="recipe.Id && recipe.Id > 0">
          <div class="row g-2">
            <div class="col-md-8">
              <textarea
                [(ngModel)]="newStep.Steps"
                class="form-control"
                placeholder="Step description"
                rows="3"
              ></textarea>
            </div>
            <div class="col-md-4">
              <input
                type="text"
                [(ngModel)]="newStep.Duration"
                class="form-control"
                placeholder="Duration (e.g., 15 mins)"
              />
              <button (click)="addStep()" class="btn btn-primary w-100 mt-2"> Add Step </button>
            </div>
          </div>
        </div>

        <!-- Steps List -->
        <div *ngIf="steps.length === 0" class="alert alert-info">
          No steps added yet.
        </div>

        <div *ngIf="steps.length > 0" class="steps-list">
          <div *ngFor="let step of steps; let i = index" class="step-item card mb-2">
            <div class="card-body">
              <div class="row">
                <div class="col-md-8">
                  <h6>Step {{ i + 1 }}</h6>
                  <p>{{ step.Steps }}</p>
                  <small *ngIf="step.Duration" class="text-muted">Duration: {{ step.Duration }}</small>
                </div>
                <div class="col-md-4 d-flex gap-2 align-items-center">
                  <button
                    *ngIf="isEditMode"
                    (click)="deleteStep(i)"
                    class="btn btn-danger btn-sm"
                  >
                    Delete
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
